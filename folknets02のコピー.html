<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>FolkAdmin - ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
<style>
body {
  font-family: 'Hiragino Sans', sans-serif;
  margin: 20px;
  background: linear-gradient(120deg, #f6d365, #fda085);
}
h1, h2 { color: #2c3e50; }
button {
  font-size: 18px;
  padding: 12px 20px;
  margin: 5px;
  background: linear-gradient(135deg, #6dd5fa, #2980b9);
  color: white; border: none; border-radius: 8px;
  cursor: pointer; transition: 0.12s; min-width: 220px;
}
button:disabled { opacity: 0.5; cursor: not-allowed; }
button:hover:enabled { transform: scale(1.03); background: linear-gradient(135deg, #89f7fe, #66a6ff); }
input, select, textarea {
  width: 300px; padding: 6px; margin-top: 6px;
  border-radius: 4px; border: 1px solid #ccc;
}
section {
  display: none; margin-top: 20px; background: white;
  padding: 20px; border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.active { display: block; }
#menuTable { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
td { padding: 10px; text-align: center; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
th { background: #f0f0f0; }
.todo-warning { color: red; font-weight: bold; }
.name-display { margin-left: 10px; color: #333; font-weight: bold; }
.back-btn {
  margin-top: 15px; background: linear-gradient(135deg, #ffd86f, #fc6262);
  color: #333; font-weight: bold;
}
.small { width: 180px; }
</style>
</head>
<body>

<h1>FolkAdmin - ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>

<!-- ãƒ­ã‚°ã‚¤ãƒ³ -->
<section id="login" class="active">
  <h2>ãƒ­ã‚°ã‚¤ãƒ³</h2>
  <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼š<input type="password" id="password"></label>
  <button onclick="checkLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
  <p id="loginMessage" style="color:red;"></p>
</section>

<!-- éƒ¨å“¡ç•ªå·å…¥åŠ› -->
<section id="userAccess">
  <h2>éƒ¨å“¡ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
  <label>éƒ¨å“¡ç•ªå·ï¼š<input type="text" id="accessId" oninput="checkMemberId()"></label>
  <span id="accessName" class="name-display"></span>
</section>

<!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
<section id="menuSection">
  <h2>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
  <table id="menuTable"></table>
</section>

<!-- ãƒ›ãƒ¼ãƒ  -->
<section id="home">
  <h2>ãƒ›ãƒ¼ãƒ ï¼ˆToDoï¼‰</h2>
  <div id="todo"></div>
  <button class="back-btn" onclick="goMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>
</section>

<!-- ç‰©å“ç®¡ç† -->
<section id="items">
  <h2>ç‰©å“ç®¡ç†ï¼ˆç™»éŒ²ï¼‰</h2>
  <label>ç‰©å“åï¼š<input type="text" id="itemName"></label><br>
  <label>çŠ¶æ…‹ï¼š
    <select id="itemStatus">
      <option>è‰¯å¥½</option><option>ä¸€éƒ¨ä¸è‰¯ç‚¹ã‚ã‚Š</option><option>ä½¿ç”¨ä¸å¯</option>
      <option>å¼¦ãªã—</option><option>ä»˜å±å“è¡Œæ–¹ä¸æ˜</option><option>ä¿®ç†ä¸­</option>
    </select>
  </label><br>
  <label>å‚™è€ƒï¼š<textarea id="itemNote" rows="2"></textarea></label><br>
  <button onclick="addItem()">ç™»éŒ²</button>
  <h3>ç‰©å“ä¸€è¦§</h3>
  <table id="itemTable">
    <thead><tr><th>ç•ªå·</th><th>åå‰</th><th>çŠ¶æ…‹</th><th>å‚™è€ƒ</th><th>ç™»éŒ²è€…</th></tr></thead>
    <tbody id="itemTableBody"></tbody>
  </table>
  <button class="back-btn" onclick="goMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>
</section>

<!-- ç‰©å“ç·¨é›†ï¼ˆè¿½åŠ æ©Ÿèƒ½ï¼‰ -->
<section id="itemEdit">
  <h2>ç‰©å“æƒ…å ±å¤‰æ›´</h2>
  <label>å¤‰æ›´ã™ã‚‹ç‰©å“ï¼š<select id="itemSelect" onchange="loadItemForEdit()"></select></label><br><br>
  <label>ç‰©å“åï¼š<input type="text" id="editItemName"></label><br>
  <label>çŠ¶æ…‹ï¼š
    <select id="editItemStatus">
      <option>è‰¯å¥½</option><option>ä¸€éƒ¨ä¸è‰¯ç‚¹ã‚ã‚Š</option><option>ä½¿ç”¨ä¸å¯</option>
      <option>å¼¦ãªã—</option><option>ä»˜å±å“è¡Œæ–¹ä¸æ˜</option><option>ä¿®ç†ä¸­</option>
    </select>
  </label><br>
  <label>å‚™è€ƒï¼š<textarea id="editItemNote" rows="2"></textarea></label><br>
  <button onclick="updateItem()">ğŸ’¾ ä¿å­˜</button>
  <button onclick="deleteItem()" style="background:linear-gradient(135deg,#ff9a9e,#f857a6)">ğŸ—‘ å‰Šé™¤</button>
  <h3>ä¸€è¦§ï¼ˆç·¨é›†ç”¨ï¼‰</h3>
  <table id="itemEditTable">
    <thead><tr><th>ID</th><th>åå‰</th><th>çŠ¶æ…‹</th><th>å‚™è€ƒ</th></tr></thead>
    <tbody id="itemEditTableBody"></tbody>
  </table>
  <button class="back-btn" onclick="goMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>
</section>

<!-- ãƒ©ã‚¤ãƒ–é–¢é€£: æ–°ãƒ©ã‚¤ãƒ–ç™»éŒ² -->
<section id="futureLiveAdd">
  <h2>æ–°ãƒ©ã‚¤ãƒ–ç™»éŒ²</h2>
  <label>ãƒ©ã‚¤ãƒ–åï¼š<input type="text" id="liveName"></label><br>
  <label>æ—¥ä»˜ï¼š<input type="date" id="liveDate"></label><br>
  <label>ä¼šå ´ï¼š<input type="text" id="livePlace"></label><br>
  <label>æŒã¡æ™‚é–“ï¼ˆæ›²æ•°ï¼‰ï¼š<input type="number" id="liveSongsLimit" min="1" class="small"></label><br>
  <button onclick="addFutureLive()">ç™»éŒ²</button>
  <button class="back-btn" onclick="goMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>
</section>

<!-- ãƒ©ã‚¤ãƒ–å‰Šé™¤ -->
<section id="futureLiveRemove">
  <h2>æ–°ãƒ©ã‚¤ãƒ–ç™»éŒ²è§£é™¤</h2>
  <label>å‰Šé™¤ã™ã‚‹ãƒ©ã‚¤ãƒ–ï¼š<select id="futureLiveSelect"></select></label><br>
  <button onclick="removeFutureLive()">å‰Šé™¤</button>
  <button class="back-btn" onclick="goMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>
</section>

<!-- å‡ºæ¼”äºˆå®šç™»éŒ² -->
<section id="confirmedLiveAdd">
  <h2>ãƒ©ã‚¤ãƒ–å‡ºæ¼”äºˆå®šç™»éŒ²</h2>
  <label>ãƒ©ã‚¤ãƒ–é¸æŠï¼š<select id="futureLiveSelectForConfirm"></select></label><br>
  <button onclick="confirmLive()">ç™»éŒ²</button>
  <button class="back-btn" onclick="goMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>
</section>

<!-- å‡ºæ¼”äºˆå®šè§£é™¤ -->
<section id="confirmedLiveRemove">
  <h2>ãƒ©ã‚¤ãƒ–å‡ºæ¼”äºˆå®šè§£é™¤</h2>
  <label>å‰Šé™¤ã™ã‚‹ãƒ©ã‚¤ãƒ–ï¼š<select id="confirmedLiveSelect"></select></label><br>
  <button onclick="removeConfirmedLive()">å‰Šé™¤</button>
  <button class="back-btn" onclick="goMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>
</section>

<!-- ãƒãƒ³ãƒ‰ç™»éŒ² -->
<section id="bandAdd">
  <h2>ãƒ©ã‚¤ãƒ–ãƒãƒ³ãƒ‰ç™»éŒ²</h2>
  <label>ãƒ©ã‚¤ãƒ–é¸æŠï¼š<select id="bandLiveSelect"></select></label><br>
  <label>æ›²åï¼š<input type="text" id="bandSong"></label><br>
  <label>ãƒ¡ãƒ³ãƒãƒ¼ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰ï¼š<input type="text" id="bandMembers"></label><br>
  <label>æ‹…å½“æ¥½å™¨ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰ï¼š<input type="text" id="bandInstruments"></label><br>
  <label>æ›²æ™‚é–“ï¼š<input type="text" id="bandDuration" class="small"></label><br>
  <label>å‚™è€ƒï¼š<input type="text" id="bandNote"></label><br>
  <button onclick="addBand()">ç™»éŒ²</button>
  <button class="back-btn" onclick="goMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>
</section>

<!-- ãƒãƒ³ãƒ‰å‰Šé™¤ -->
<section id="bandRemove">
  <h2>ãƒ©ã‚¤ãƒ–ãƒãƒ³ãƒ‰ç™»éŒ²è§£é™¤</h2>
  <label>å‰Šé™¤ã™ã‚‹ãƒãƒ³ãƒ‰ï¼š<select id="bandSelect"></select></label><br>
  <button onclick="removeBand()">å‰Šé™¤</button>
  <button class="back-btn" onclick="goMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>
</section>

<!-- ãƒ©ã‚¤ãƒ–è©³ç´°è¡¨ç¤º -->
<section id="liveDetails">
  <h2>ãƒ©ã‚¤ãƒ–åˆ¥å‡ºæ¼”æ›²ãƒ»ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§</h2>
  <label>ãƒ©ã‚¤ãƒ–é¸æŠï¼š<select id="liveDetailSelect" onchange="showLiveDetails()"></select></label>
  <table id="liveDetailTable">
    <thead><tr><th>æ›²å</th><th>ãƒ¡ãƒ³ãƒãƒ¼</th><th>æ‹…å½“æ¥½å™¨</th><th>æ›²æ™‚é–“</th><th>å‚™è€ƒ</th></tr></thead>
    <tbody id="liveDetailTableBody"></tbody>
  </table>
  <button class="back-btn" onclick="goMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>
</section>

<!-- éƒ¨å“¡ç®¡ç† -->
<section id="userRegister">
  <h2>éƒ¨å“¡ç•ªå·ç™»éŒ²ï¼ˆéƒ¨é•·å°‚ç”¨ï¼‰</h2>
  <label>åå‰ï¼š<input type="text" id="userName"></label>
  <button onclick="registerUser()">ç™»éŒ²</button>
  <ul id="userList"></ul>
  <button class="back-btn" onclick="goMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>
</section>

<section id="userListView">
  <h2>éƒ¨å“¡ç•ªå·ä¸€è¦§</h2>
  <table id="userTable"><thead><tr><th>åå‰</th><th>ç•ªå·</th></tr></thead><tbody id="userTableBody"></tbody></table>
  <button class="back-btn" onclick="goMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>
</section>

<!-- é›»å­ã‚¸ãƒ£ãƒ¼ãƒŠãƒ« -->
<section id="journal">
  <h2>é›»å­ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ãƒ“ãƒ¥ã‚¢ãƒ¼</h2>
  <table id="journalTable"><thead><tr><th>æ—¥æ™‚</th><th>ç•ªå·</th><th>åå‰</th><th>æ“ä½œ</th><th>å¯¾è±¡</th></tr></thead><tbody id="journalTableBody"></tbody></table>
  <button class="back-btn" onclick="goMenu()">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>
</section>

<script>
/* ----- åˆæœŸå®šæ•° / ãƒ‡ãƒ¼ã‚¿ï¼ˆlocalStorageï¼‰ ----- */
const MAIN_PASS="folknet";
const LEADER_PASS="leader123";
const VIEW_PASS="viewonly";
const JOURNAL_PASS="journalpass";

let users = JSON.parse(localStorage.getItem('users')) || [{id: "110113", name: "åœ‹ä¸­ã€€æ¶¼ä½‘"}];
let todos = JSON.parse(localStorage.getItem('todos')) || [];
let items = JSON.parse(localStorage.getItem('items')) || [];
let futureLives = JSON.parse(localStorage.getItem('futureLives')) || [];
let confirmedLives = JSON.parse(localStorage.getItem('confirmedLives')) || [];
let bands = JSON.parse(localStorage.getItem('bands')) || [];
let journal = JSON.parse(localStorage.getItem('journal')) || [];

let currentUser = null;

// â˜… ãƒ©ã‚¤ãƒ–å‡ºæ¼”äºˆå®šè§£é™¤ï¼ˆä¿®æ­£ç‰ˆï¼‰
function removeConfirmedLive() {
  const select = document.getElementById('confirmedLiveSelect');
  const selectedName = select.value;

  if (!selectedName) {
    alert("å‰Šé™¤ã™ã‚‹ãƒ©ã‚¤ãƒ–ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
    return;
  }

  // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
  if (!confirm(`ã€Œ${selectedName}ã€ã‚’å‡ºæ¼”äºˆå®šã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;

  // é…åˆ—ã‹ã‚‰å‰Šé™¤
  confirmedLives = confirmedLives.filter(l => l.name !== selectedName);

  // localStorage æ›´æ–°
  localStorage.setItem('confirmedLives', JSON.stringify(confirmedLives));

  // é¸æŠãƒªã‚¹ãƒˆã‚’æ›´æ–°
  loadConfirmedLiveSelect();

  alert(`ã€Œ${selectedName}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼`);
}

// â˜… å‡ºæ¼”äºˆå®šãƒ©ã‚¤ãƒ–ä¸€è¦§ã‚’èª­ã¿è¾¼ã‚€ï¼ˆä¿®æ­£ç‰ˆï¼‰
function loadConfirmedLiveSelect() {
  const select = document.getElementById('confirmedLiveSelect');
  select.innerHTML = '';

  if (confirmedLives.length === 0) {
    const opt = document.createElement('option');
    opt.textContent = 'ï¼ˆç™»éŒ²ã•ã‚ŒãŸå‡ºæ¼”äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰';
    opt.disabled = true;
    select.appendChild(opt);
    return;
  }

  confirmedLives.forEach(live => {
    const opt = document.createElement('option');
    opt.value = live.name;
    opt.textContent = `${live.name} (${live.date || 'æ—¥ä»˜æœªè¨­å®š'})`;
    select.appendChild(opt);
  });
}

// åˆæœŸåŒ–æ™‚ã«å‘¼ã³å‡ºã™
loadConfirmedLiveSelect();


/* ----- ãƒ­ã‚°ã‚¤ãƒ³ / ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠ ----- */
function checkLogin(){
  const pass = document.getElementById('password').value;
  if(pass===MAIN_PASS || pass===LEADER_PASS || pass===VIEW_PASS || pass===JOURNAL_PASS){
    document.getElementById('login').classList.remove('active');
    document.getElementById('userAccess').classList.add('active');
  } else {
    document.getElementById('loginMessage').innerText='ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™';
  }
}
function checkMemberId(){
  const id = document.getElementById('accessId').value.trim();
  const user = users.find(u => u.id === id);
  const nameDisplay = document.getElementById('accessName');
  if(user){
    nameDisplay.innerText = user.name;
    currentUser = user;
    loadMenu();
  } else {
    nameDisplay.innerText = '';
  }
}

/* ----- ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºï¼ˆå…ƒã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ä¿æŒ + ç‰©å“ç·¨é›†ï¼‰ ----- */
function loadMenu(){
  const menuTable = document.getElementById('menuTable');
  menuTable.innerHTML = '';
  const menuItems = [
    {name:'ãƒ›ãƒ¼ãƒ ', func:()=>showSection('home')},
    {name:'ç‰©å“ç®¡ç†', func:()=>showSection('items')},
    {name:'ç‰©å“æƒ…å ±å¤‰æ›´', func:()=>showSection('itemEdit')},
    {name:'æ–°ãƒ©ã‚¤ãƒ–ç™»éŒ²', func:()=>showSection('futureLiveAdd')},
    {name:'æ–°ãƒ©ã‚¤ãƒ–ç™»éŒ²è§£é™¤', func:()=>showSection('futureLiveRemove')},
    {name:'ãƒ©ã‚¤ãƒ–å‡ºæ¼”äºˆå®šç™»éŒ²', func:()=>showSection('confirmedLiveAdd')},
    {name:'ãƒ©ã‚¤ãƒ–å‡ºæ¼”äºˆå®šè§£é™¤', func:()=>showSection('confirmedLiveRemove')},
    {name:'ãƒ©ã‚¤ãƒ–ãƒãƒ³ãƒ‰ç™»éŒ²', func:()=>showSection('bandAdd')},
    {name:'ãƒ©ã‚¤ãƒ–ãƒãƒ³ãƒ‰ç™»éŒ²è§£é™¤', func:()=>showSection('bandRemove')},
    {name:'ãƒ©ã‚¤ãƒ–è©³ç´°ãƒ“ãƒ¥ãƒ¼', func:()=>showSection('liveDetails')},
    {name:'éƒ¨å“¡ç•ªå·ç™»éŒ²', func:()=>showSection('userRegister')},
    {name:'éƒ¨å“¡ç•ªå·ä¸€è¦§', func:()=>showSection('userListView')},
    {name:'é›»å­ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«', func:()=>showSection('journal')}
  ];
  menuItems.forEach(m=>{
    const tr = document.createElement('tr');
    const td = document.createElement('td');
    const btn = document.createElement('button');
    btn.innerText = m.name;
    btn.onclick = m.func;
    td.appendChild(btn);
    tr.appendChild(td);
    menuTable.appendChild(tr);
  });
  document.getElementById('userAccess').classList.remove('active');
  document.getElementById('menuSection').classList.add('active');
}

/* ----- ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ‡æ›¿ã¨åˆæœŸåŒ– ----- */
function showSection(id){
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.getElementById('menuSection').classList.add('active');
  document.getElementById(id).classList.add('active');
  if(id === 'itemEdit') loadItemSelect();
  if(id === 'futureLiveRemove' || id==='futureLiveAdd' || id==='confirmedLiveAdd' || id==='confirmedLiveRemove' || id==='bandAdd' || id==='bandRemove' || id==='liveDetails') refreshLiveSelects();
}
function goMenu(){ showSection('menuSection'); }

/* ----- ç‰©å“ç™»éŒ² / è¡¨ç¤º ----- */
function addItem(){
  const name = document.getElementById('itemName').value.trim();
  const status = document.getElementById('itemStatus').value;
  const note = document.getElementById('itemNote').value.trim();
  if(!name){ alert('ç‰©å“åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  const newItem = { id: items.length? Math.max(...items.map(i=>i.id))+1 : 1, name, status, note, registeredBy: currentUser? currentUser.name : 'ä¸æ˜' };
  items.push(newItem);
  localStorage.setItem('items', JSON.stringify(items));
  updateItemTable();
  alert('ç‰©å“ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
  // clear inputs
  document.getElementById('itemName').value = '';
  document.getElementById('itemNote').value = '';
}
function updateItemTable(){
  const tbody = document.getElementById('itemTableBody');
  tbody.innerHTML = '';
  items.forEach(i=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${i.id}</td><td>${i.name}</td><td>${i.status}</td><td>${i.note||''}</td><td>${i.registeredBy||''}</td>`;
    tbody.appendChild(tr);
  });
}

/* ----- ç‰©å“ç·¨é›†ï¼ˆèª­ã¿è¾¼ã¿ãƒ»æ›´æ–°ãƒ»å‰Šé™¤ï¼‰ ----- */
function loadItemSelect(){
  const sel = document.getElementById('itemSelect');
  sel.innerHTML = '';
  items.forEach(i=>{
    const opt = document.createElement('option');
    opt.value = i.id;
    opt.textContent = `${i.id}: ${i.name}`;
    sel.appendChild(opt);
  });
  if(items.length>0) loadItemForEdit();
  updateItemEditTable();
}
function loadItemForEdit(){
  const id = parseInt(document.getElementById('itemSelect').value);
  const item = items.find(x=>x.id===id);
  if(!item) return;
  document.getElementById('editItemName').value = item.name;
  document.getElementById('editItemStatus').value = item.status;
  document.getElementById('editItemNote').value = item.note || '';
}
function updateItem(){
  const id = parseInt(document.getElementById('itemSelect').value);
  const item = items.find(x=>x.id===id);
  if(!item) return;
  item.name = document.getElementById('editItemName').value.trim();
  item.status = document.getElementById('editItemStatus').value;
  item.note = document.getElementById('editItemNote').value.trim();
  localStorage.setItem('items', JSON.stringify(items));
  updateItemEditTable();
  updateItemTable();
  alert('ç‰©å“æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼');
}
function deleteItem(){
  const id = parseInt(document.getElementById('itemSelect').value);
  if(!confirm('æœ¬å½“ã«ã“ã®ç‰©å“ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  items = items.filter(x=>x.id!==id);
  localStorage.setItem('items', JSON.stringify(items));
  updateItemEditTable();
  updateItemTable();
  loadItemSelect();
  alert('å‰Šé™¤ã—ã¾ã—ãŸ');
}
function updateItemEditTable(){
  const tbody = document.getElementById('itemEditTableBody');
  tbody.innerHTML = '';
  items.forEach(i=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${i.id}</td><td>${i.name}</td><td>${i.status}</td><td>${i.note||''}</td>`;
    tbody.appendChild(tr);
  });
}

/* ----- ãƒ©ã‚¤ãƒ–ç™»éŒ²/ç®¡ç† ----- */
function addFutureLive(){
  const name = document.getElementById('liveName').value.trim();
  const date = document.getElementById('liveDate').value;
  const place = document.getElementById('livePlace').value.trim();
  const limit = parseInt(document.getElementById('liveSongsLimit').value) || null;
  if(!name){ alert('ãƒ©ã‚¤ãƒ–åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  futureLives.push({ name, date, place, limit });
  localStorage.setItem('futureLives', JSON.stringify(futureLives));
  refreshLiveSelects();
  alert('ãƒ©ã‚¤ãƒ–ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
  document.getElementById('liveName').value=''; document.getElementById('livePlace').value='';
}
function removeFutureLive(){
  const sel = document.getElementById('futureLiveSelect');
  const name = sel.value;
  if(!name) return;
  if(!confirm(`ã€Œ${name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;
  futureLives = futureLives.filter(l=>l.name!==name);
  // ä½µã›ã¦confirmedLives and bandsã®é–¢é€£ã¯æ®‹ã™ï¼æ¶ˆã™åˆ¤æ–­ã¯ä»»ã›ã‚‹ â€” ã“ã“ã§ã¯ãƒãƒ³ãƒ‰ã®ãƒ©ã‚¤ãƒ–å‚ç…§ã‚’æ®‹ã—ã¾ã™
  localStorage.setItem('futureLives', JSON.stringify(futureLives));
  refreshLiveSelects();
  alert('å‰Šé™¤ã—ã¾ã—ãŸ');
}
function confirmLive(){
  const sel = document.getElementById('futureLiveSelectForConfirm');
  const name = sel.value;
  if(!name) return;
  if(!confirmedLives.find(l=>l.name===name)){
    const live = futureLives.find(l=>l.name===name) || {name};
    confirmedLives.push(live);
    localStorage.setItem('confirmedLives', JSON.stringify(confirmedLives));
    refreshLiveSelects();
    alert('å‡ºæ¼”äºˆå®šã«ç™»éŒ²ã—ã¾ã—ãŸ');
  } else {
    alert('æ—¢ã«å‡ºæ¼”äºˆå®šã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™');
  }
}
function removeConfirmedLive(){
  const sel = document.getElementById('confirmedLiveSelect');
  const name = sel.value;
  if(!name) return;
  confirmedLives = confirmedLives.filter(l=>l.name!==name);
  localStorage.setItem('confirmedLives', JSON.stringify(confirmedLives));
  refreshLiveSelects();
  alert('å‡ºæ¼”äºˆå®šã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸ');
}

/* ----- ãƒãƒ³ãƒ‰ï¼ˆæ›²ï¼‰ç™»éŒ² / å‰Šé™¤ ----- */
function addBand(){
  const live = document.getElementById('bandLiveSelect').value;
  const song = document.getElementById('bandSong').value.trim();
  const members = document.getElementById('bandMembers').value.trim();
  const instruments = document.getElementById('bandInstruments').value.trim();
  const duration = document.getElementById('bandDuration').value.trim();
  const note = document.getElementById('bandNote').value.trim();
  if(!live || !song){ alert('ãƒ©ã‚¤ãƒ–ã¨æ›²åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  bands.push({ live, song, members, instruments, duration, note });
  localStorage.setItem('bands', JSON.stringify(bands));
  refreshBandSelects();
  alert('ãƒãƒ³ãƒ‰ï¼ˆæ›²ï¼‰ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
  // clear inputs
  document.getElementById('bandSong').value=''; document.getElementById('bandMembers').value=''; document.getElementById('bandInstruments').value=''; document.getElementById('bandDuration').value=''; document.getElementById('bandNote').value='';
}
function removeBand(){
  const sel = document.getElementById('bandSelect');
  const idx = parseInt(sel.value);
  if(isNaN(idx)) return;
  // bandSelect options store index mapping; remove that band
  bands.splice(idx,1);
  localStorage.setItem('bands', JSON.stringify(bands));
  refreshBandSelects();
  alert('å‰Šé™¤ã—ã¾ã—ãŸ');
}
function refreshBandSelects(){
  const bandSel = document.getElementById('bandSelect');
  bandSel.innerHTML = '';
  bands.forEach((b, index) => {
    const opt = document.createElement('option');
    opt.value = index;
    opt.textContent = `${b.live} - ${b.song} (${b.members||''})`;
    bandSel.appendChild(opt);
  });
}

/* ----- ãƒ©ã‚¤ãƒ–ç³»ã‚»ãƒ¬ã‚¯ãƒˆã‚’æ›´æ–° ----- */
function refreshLiveSelects(){
  // futureLiveSelect, futureLiveSelectForConfirm, confirmedLiveSelect, bandLiveSelect, liveDetailSelect
  const fsel = document.getElementById('futureLiveSelect');
  const fsel2 = document.getElementById('futureLiveSelectForConfirm');
  const csel = document.getElementById('confirmedLiveSelect');
  const blsel = document.getElementById('bandLiveSelect');
  const ldsel = document.getElementById('liveDetailSelect');

  [fsel, fsel2, blsel, ldsel].forEach(s=>{ if(s) s.innerHTML = ''; });

  futureLives.forEach(l=>{
    const o1 = document.createElement('option'); o1.value = l.name; o1.textContent = `${l.name} (${l.date||''})`; fsel && fsel.appendChild(o1);
    const o2 = document.createElement('option'); o2.value = l.name; o2.textContent = `${l.name} (${l.date||''})`; fsel2 && fsel2.appendChild(o2);
    const o3 = document.createElement('option'); o3.value = l.name; o3.textContent = `${l.name} (${l.date||''})`; blsel && blsel.appendChild(o3);
    const o4 = document.createElement('option'); o4.value = l.name; o4.textContent = `${l.name} (${l.date||''})`; ldsel && ldsel.appendChild(o4);
  });

  confirmedLives.forEach(l=>{
    const oc = document.createElement('option'); oc.value = l.name; oc.textContent = `${l.name} (${l.date||''})`; csel && csel.appendChild(oc);
    // also add confirmed to band/live detail lists
    const o3 = document.createElement('option'); o3.value = l.name; o3.textContent = `${l.name} (${l.date||''})`; blsel && blsel.appendChild(o3);
    const o4 = document.createElement('option'); o4.value = l.name; o4.textContent = `${l.name} (${l.date||''})`; ldsel && ldsel.appendChild(o4);
  });

  // If none, add placeholder
  [fsel, fsel2, csel, blsel, ldsel].forEach(s=>{
    if(!s) return;
    if(s.options.length===0){
      const opt = document.createElement('option');
      opt.value = '';
      opt.textContent = '(ç™»éŒ²ãªã—)';
      s.appendChild(opt);
    }
  });

  refreshBandSelects();
}

/* ----- ãƒ©ã‚¤ãƒ–è©³ç´°è¡¨ç¤º ----- */
function showLiveDetails(){
  const liveName = document.getElementById('liveDetailSelect').value;
  const tbody = document.getElementById('liveDetailTableBody');
  tbody.innerHTML = '';
  const liveBands = bands.filter(b=>b.live === liveName);
  if(liveBands.length===0){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td colspan="5">ç™»éŒ²ã•ã‚ŒãŸæ›²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td>`;
    tbody.appendChild(tr);
  } else {
    liveBands.forEach(b=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${b.song}</td><td>${b.members}</td><td>${b.instruments}</td><td>${b.duration}</td><td>${b.note}</td>`;
      tbody.appendChild(tr);
    });
  }
}

/* ----- éƒ¨å“¡ç®¡ç† ----- */
function registerUser(){
  const name = document.getElementById('userName').value.trim();
  if(!name){ alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  const id = prompt('éƒ¨å“¡ç•ªå·ã‚’å…¥åŠ›');
  if(!id){ alert('ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  users.push({ id, name });
  localStorage.setItem('users', JSON.stringify(users));
  updateUserList();
  alert('ç™»éŒ²ã—ã¾ã—ãŸ');
  document.getElementById('userName').value='';
}
function updateUserList(){
  const tbody = document.getElementById('userTableBody');
  tbody.innerHTML = '';
  users.forEach(u=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u.name}</td><td>${u.id}</td>`;
    tbody.appendChild(tr);
  });
}

/* ----- TODO ã¨ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ï¼ˆè¡¨ç¤ºã®ã¿ã®ç°¡æ˜“å®Ÿè£…ï¼‰ ----- */
function updateTodo(){
  const div = document.getElementById('todo');
  div.innerHTML = '';
  todos.forEach((t,i)=>{
    const p = document.createElement('p');
    p.innerHTML = `${i+1}. ${t.text} ${t.urgent?'<span class="todo-warning">â€»è¦å¯¾å¿œ</span>':''}`;
    div.appendChild(p);
  });
}
function updateJournalTable(){
  const tbody = document.getElementById('journalTableBody');
  tbody.innerHTML = '';
  journal.forEach(j=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${j.datetime||''}</td><td>${j.id||''}</td><td>${j.name||''}</td><td>${j.action||''}</td><td>${j.target||''}</td>`;
    tbody.appendChild(tr);
  });
}

/* ----- åˆæœŸæç”» ----- */
function initAll(){
  updateItemTable();
  updateItemEditTable();
  updateUserList();
  updateTodo();
  updateJournalTable();
  refreshLiveSelects();
}
initAll();

</script>

</body>
</html>
